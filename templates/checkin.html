<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Check-In | Attendance System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <style>
    body {
      background: linear-gradient(135deg, #65ec2b, #3391fb);
      background-size: cover;
      background-position: center;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Segoe UI", sans-serif;
    }

    .box {
      background-color: rgba(255, 255, 255, 0.92);
      padding: 40px 32px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      min-width: 350px;
      max-width: 95vw;
    }

    #result {
      font-size: 1.2rem;
      margin-top: 20px;
    }
    #statusMsg {
      min-height: 2.5em;
    }
    .face-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      color: #3391fb;
      animation: bounceIn 1s;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.5); opacity: 0; }
      60% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); }
    }
  </style>
</head>

<body>
  <div class="box animate__animated animate__zoomIn">
    <div class="face-icon animate__animated animate__bounceIn">üßë‚Äçüíª</div>
    <h2 class="mb-4">Face Recognition Check-In</h2>

    {% if result %}
    <div id="result" class="alert alert-info animate__animated animate__fadeIn">
      {{ result }}
    </div>
    <script>
      // Wait for speech to finish before redirecting
      const resultText = "{{ result }}";
      let speakText;

      if (resultText.toLowerCase().includes("welcome")) {
        speakText = resultText;
      } else if (resultText.toLowerCase().includes("not recognized")) {
        speakText = "Sorry, face not recognized. Please try again.";
      } else {
        speakText = "Result: " + resultText;
      }

      const utterance = new SpeechSynthesisUtterance(speakText);
      speechSynthesis.speak(utterance);

      utterance.onend = function() {
        window.location.href = "/";
      };
    </script>
    {% else %}
    <div id="statusMsg" class="mt-4 text-muted animate__animated"></div>
    <div id="spinner" class="spinner-border spinner-border-lg text-success mt-4" role="status" style="display:none;"></div>
    <script>
      // Start process immediately on page load
      window.addEventListener("DOMContentLoaded", function() {
        const statusMsg = document.getElementById("statusMsg");
        const spinner = document.getElementById("spinner");
        spinner.style.display = "inline-block";
        statusMsg.innerHTML = "Initializing camera and scanning face. Please wait...";
        statusMsg.classList.add("animate__fadeIn");

        // Simulate slow analysis (e.g., 4 seconds)
        setTimeout(() => {
          statusMsg.innerHTML = "Analyzing and verifying identity. Please hold still...";
        }, 2000);

        setTimeout(() => {
          // Submit the form automatically after analysis
          const form = document.createElement("form");
          form.method = "POST";
          document.body.appendChild(form);
          form.submit();
        }, 4000);
      });
    </script>
    {% endif %}
  </div>
</body>
</html>